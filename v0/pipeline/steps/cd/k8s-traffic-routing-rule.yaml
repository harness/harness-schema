title: TrafficRouteRule
type: object
required:
  - type
  - spec
properties:
  type:
    type: string
    enum:
      - uri
      - method
      - header
      - port
      - scheme
      - authority
$schema: http://json-schema.org/draft-07/schema#
allOf:
  - if:
      properties:
        type:
          const: uri
    then:
      properties:
        spec:
          title: TrafficRoutingRuleURISpec
          type: object
          required:
            - name
            - value
          properties:
            name:
              type: string
            value:
              type: string
            matchType:
              type: string
              enum:
                - exact
                - prefix
                - regex
          $schema: http://json-schema.org/draft-07/schema#
  - if:
      properties:
        type:
          const: method
    then:
      properties:
        spec:
          title: TrafficRoutingRuleMethodSpec
          type: object
          oneOf:
            - required:
                - name
                - values
              properties:
                name:
                  type: string
                values:
                  type: array
                  items:
                    type: string
                    minLength: 1
                    enum:
                      - GET
                      - POST
                      - PUT
                      - DELETE
                      - HEAD
                      - CONNECT
                      - OPTION
                      - TRACE
                      - PATCH
            - required:
                - name
                - value
                - matchType
              properties:
                name:
                  type: string
                value:
                  type: string
                  enum:
                    - GET
                    - POST
                    - PUT
                    - DELETE
                    - HEAD
                    - CONNECT
                    - OPTION
                    - TRACE
                    - PATCH
                matchType:
                  type: string
                  enum:
                    - exact
                    - prefix
                    - regex
          $schema: http://json-schema.org/draft-07/schema#
  - if:
      properties:
        type:
          const: header
    then:
      properties:
        spec:
          title: TrafficRoutingRuleHeaderSpec
          type: object
          required:
            - name
            - values
          properties:
            name:
              type: string
            values:
              type: array
              items:
                minLength: 1
                type: object
                required:
                  - key
                  - value
                properties:
                  key:
                    type: string
                  value:
                    type: string
                  matchType:
                    type: string
                    enum:
                      - exact
                      - prefix
                      - regex
                  $schema: http://json-schema.org/draft-07/schema#
          $schema: http://json-schema.org/draft-07/schema#
  - if:
      properties:
        type:
          const: port
    then:
      properties:
        spec:
          title: TrafficRoutingRulePortSpec
          type: object
          oneOf:
           - required:
              - name
              - values
             properties:
                name:
                  type: string
                values:
                  type: array
                  items:
                    type: number
                    minLength: 1
           - required:
               - name
               - value
             properties:
              name:
                type: string
              value:
                type: number
          $schema: http://json-schema.org/draft-07/schema#
  - if:
      properties:
        type:
          const: scheme
    then:
      properties:
        spec:
          title: TrafficRoutingRuleSchemeSpec
          type: object
          required:
            - name
            - value
            - matchType
          properties:
            name:
              type: string
            value:
              type: string
            matchType:
              type: string
              enum:
                - exact
                - prefix
                - regex
          $schema: http://json-schema.org/draft-07/schema#
  - if:
      properties:
        type:
          const: authority
    then:
      properties:
        spec:
          title: TrafficRoutingRuleAuthoritySpec
          type: object
          required:
            - name
            - value
            - matchType
          properties:
            name:
              type: string
            value:
              type: string
            matchType:
              type: string
              enum:
                - exact
                - prefix
                - regex
          $schema: http://json-schema.org/draft-07/schema#
