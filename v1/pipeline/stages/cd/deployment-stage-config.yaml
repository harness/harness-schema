$schema: http://json-schema.org/draft-07/schema#
title: DeploymentStageConfig
type: object
required:
- steps
properties:
  custom_deployment:
    $ref: step-template-ref.yaml
  deployment:
    type: string
    enum:
    - kubernetes
    - native-helm
    - ssh
    - winrm
    - serverless-aws-lambda
    - azure-webapp
    - custom-deployment
    - ecs
    - elastigroup
    - tas
    - asg
    - google-cloud-functions
    - aws-lambda
    - aws-sam
  steps:
    type: array
    items:
      configRef: ./deployment-stage-spec-element-wrapper-config.yaml/steps
    maxItems: 256
    minItems: 1
  rollbackSteps:
    type: array
    items:
      configRef: ./deployment-stage-spec-element-wrapper-config.yaml/steps
    maxItems: 256
    minItems: 1
  environment:
    $ref: environment-yaml-v2.yaml
  environmentGroup:
    $ref: environment-group-yaml.yaml
  environments:
    $ref: environments-yaml.yaml
  gitOpsEnabled:
    type: boolean
  infrastructure:
    $ref: pipeline-infrastructure.yaml
  service:
    $ref: service-yaml-v2.yaml
  serviceConfig:
    $ref: service-config.yaml
  services:
    $ref: services-yaml.yaml
  desc:
    description: This is the description for DeploymentStageConfig
allOf:
- if:
    properties:
      deployment:
        const: aws-sam
  then:
    properties:
      metadata:
        $ref: aws-sam-deployment-meta-data.yaml
- if:
    properties:
      deployment:
        const: asg
  then:
    properties:
      metadata:
        $ref: asg-deployment-meta-data.yaml
- if:
    properties:
      deployment:
        const: aws-lambda
  then:
    properties:
      metadata:
        $ref: aws-lambda-deployment-meta-data.yaml
- if:
    properties:
      deployment:
        const: azure-web-app
  then:
    properties:
      metadata:
        $ref: azure-web-app-deployment-meta-data.yaml
- if:
    properties:
      deployment:
        const: custom-deployment
  then:
    properties:
      metadata:
        $ref: custom-deployment-meta-data.yaml
- if:
    properties:
      deployment:
        const: ecs
  then:
    properties:
      metadata:
        $ref: ecs-deployment-meta-data.yaml
- if:
    properties:
      deployment:
        const: elastigroup
  then:
    properties:
      metadata:
        $ref: elasti-group-deployment-meta-data.yaml
- if:
    properties:
      deployment:
        const: google-cloud-functions
  then:
    properties:
      metadata:
        $ref: google-cloud-function-deployment-meta-data.yaml
- if:
    properties:
      deployment:
        const: kubernetes
  then:
    properties:
      metadata:
        $ref: kubernetes-deployment-meta-data.yaml
- if:
    properties:
      deployment:
        const: native-helm
  then:
    properties:
      metadata:
        $ref: native-helm-deployment-meta-data.yaml
- if:
    properties:
      deployment:
        const: serverless-aws-lambda
  then:
    properties:
      metadata:
        $ref: serverless-aws-lambda-deployment-meta-data.yaml
- if:
    properties:
      deployment:
        const: ssh
  then:
    properties:
      metadata:
        $ref: ssh-deployment-meta-data.yaml
- if:
    properties:
      deployment:
        const: tas
  then:
    properties:
      metadata:
        $ref: tas-deployment-meta-data.yaml
- if:
    properties:
      deployment:
        const: win-rm
  then:
    properties:
      metadata:
        $ref: winrm-deployment-meta-data.yaml
- oneOf:
  - required:
    - serviceConfig
  - required:
    - service
  - required:
    - services
- oneOf:
  - required:
    - environment
  - required:
    - environmentGroup
  - required:
    - environments
  - required:
    - infrastructure
