title: Step
type: object

properties:
  id:
    description: The unique step identifier.
    type: string
    pattern: '^[a-zA-Z0-9_-]+$'
  name:
    type: string
    description: The step name.
  desc:
    type: string
    description: The step description.
  type:
    type: string
    description: The step type.
    enum:
      - action
      - background
      - bitrise
      - group
      - parallel
      - plugin
      - template
      - test
      - run
  timeout:
    type: string
    description: The step timeout.
  strategy:
      $ref: ../common/strategy.yaml
      description: The stage execution strategy.
  when:
      description: The stage conditional logic.
      $ref: "../common/when.yaml"
  failure:
      $ref: ../common/failure_list.yaml

oneOf:
  - allOf:
      - properties:
          type:
            const: action
      - properties:
          spec:
            $ref: ./ci/step_action.yaml
  - allOf:
      - properties:
          type:
            const: background
      - properties:
          spec:
            $ref: ./ci/step_background.yaml
  - allOf:
      - properties:
          type:
            const: bitrise
      - properties:
          spec:
            $ref: ./ci/step_bitrise.yaml
  - allOf:
      - properties:
          type:
            const: test
      - properties:
          spec:
            $ref: ./ci/step_ti.yaml
  - allOf:
      - properties:
          type:
            const: group
      - properties:
          spec:
            $ref: ./common/step_group.yaml
  - allOf:
      - properties:
          type:
            const: parallel
      - properties:
          spec:
            $ref: ./common/step_parallel.yaml
  - allOf:
      - properties:
          type:
            const: plugin
      - properties:
          spec:
            $ref: ./ci/step_plugin.yaml
  - allOf:
      - properties:
          type:
            const: template
      - properties:
          spec:
            $ref: ./common/step_template.yaml
  - allOf:
      - properties:
          type:
            const: run
      - properties:
          spec:
            $ref: ./common/step_run.yaml